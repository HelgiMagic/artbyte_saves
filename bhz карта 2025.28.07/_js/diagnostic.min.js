var DiagnosticForm=function(){var n=$(".js-diagnostic-form-tab"),o=$(".diagnostic-form__step"),r=function(t){t.removeClass("-error"),$(".js-styler").removeClass("-error");var n=!0;return t.each(function(t,e){var i,s,a=$(e);!a.is("select")||""!==a.find("option").filter(":selected").val()&&"-"!==a.find("option").filter(":selected").val()?a.is("select")||a.is("div")||!a.hasClass("number")?""!==a.val()||a.is("select")||a.is("div")||($(e).addClass("-error"),n=!1):""!==a.val()&&(s=+a.val(),Number(s)===s&&s%1==0||(i=+a.val(),Number(i)===i&&i%1!=0))||($(e).addClass("-error"),n=!1):($(e).addClass("-error"),$(e).parent().addClass("-error"),n=!1),"checkbox"===a.attr("type")&&!1===a.prop("checked")&&($(e).addClass("-error"),n=!1),"EMAIL"===a.attr("name")&&""===a.val()||"EMAIL"!==a.attr("name")||isValidEmailAddress(a.val())||($(e).addClass("-error"),n=!1)}),n},c=function(t,e){var i=/,/;i.test(e)&&t.val(e.replace(i,"."))};var d=function(){var t=$(".diagnostic-form__step.is-active").data("index"),e=$(".diagnostic-form__step").last().data("index");$(".diagnostic-form__bar").width(t/e*100+"%"),$("html, body").animate({scrollTop:$(".js-diagnostic-form").offset().top-110},300,function(){})};return{init:function(){var i,t,s,e,a;i=[],t={zoom:4,center:new google.maps.LatLng(63.47805638524355,89.35147045203976)},s=new google.maps.Map(document.getElementById("diagnostic-map"),t),e=document.getElementById("pac-input"),a=new google.maps.places.SearchBox(e),s.controls[google.maps.ControlPosition.TOP_LEFT].push(e),s.addListener("bounds_changed",function(){a.setBounds(s.getBounds())}),a.addListener("places_changed",function(){var t=a.getPlaces();if(0!=t.length){i.forEach(function(t){t.setMap(null)}),i=[];var e=new google.maps.LatLngBounds;t.forEach(function(t){t.geometry?(i.push(new google.maps.Marker({map:s,icon:"/_img/map/mark.png",position:t.geometry.location})),$("input[name=FIELD_COORDINATES]").val(t.geometry.location.lat().toFixed(5)+" "+t.geometry.location.lng().toFixed(5)),t.geometry.viewport?e.union(t.geometry.viewport):e.extend(t.geometry.location)):console.log("Returned place contains no geometry")}),s.fitBounds(e)}}),s.addListener("dblclick",function(t){i.forEach(function(t){t.setMap(null)}),(i=[]).push(new google.maps.Marker({position:new google.maps.LatLng(t.latLng.lat(),t.latLng.lng()),map:s,icon:"/_img/map/mark.png"})),$("input[name=FIELD_COORDINATES]").val(t.latLng.lat().toFixed(5)+" "+t.latLng.lng().toFixed(5))}),$(".js-diagnostic-date").datetimepicker({format:"DD.MM.YYYY"}),$(document).on("keyup paste",".js-number",function(){c($(this),$(this).val())}),$(document).on("keyup paste","input[name=FIELD_VOLUME], input[name=FIELD_SOLUTION_RATE]",function(){var t=$(this).val();c($(this),t);var e,i=$("input[name=FIELD_VOLUME]").val(),s=$("input[name=FIELD_SOLUTION_RATE]").val();$("input[name=FIELD_MACHINING_AREA]").val((e=i/s*1e3,isFinite(e)?Math.round(100*parseFloat(e))/100:0))}),$(document).on("keyup paste",".js-integer",function(){var t,e=$(this),i=parseInt(e.val());e.val((t=i,!isNaN(parseFloat(t))&&isFinite(t)?t:0))}),$(document).on("change",".js-diagnostic-form-tumbler",function(){var t=$(this);t.is(":checked")?t.closest(".diagnostic-form-table__row").find(".diagnostic-form-table__sign").text("-"):t.closest(".diagnostic-form-table__row").find(".diagnostic-form-table__sign").text("+")}),$(document).on("click",".js-diagnostic-form-tab:not(.is-disabled):not(.is-active)",function(){var t=$(this),e=$(".diagnostic-form__step.is-active"),i=e.data("index"),s=t.data("index"),a=n.filter("[data-index="+i+"]");r(e.find(".req"))&&(e.removeClass("is-active"),o.filter("[data-index="+s+"]").addClass("is-active"),t.removeClass("is-complete").addClass("is-active"),a.addClass("is-complete").removeClass("is-active"),$(".js-styler").trigger("refresh"),d())}),$(document).on("click",".js-diagnostic-form-prev, .js-diagnostic-form-next",function(){var t=$(this),e=$(".diagnostic-form__step.is-active"),i=e.data("index"),s=n.filter("[data-index="+i+"]"),a=t.hasClass("js-diagnostic-form-next")?"next":"prev";r(e.find(".req"))&&(e.removeClass("is-active"),"next"===a?(t.closest(".diagnostic-form__step").next().addClass("is-active"),s.removeClass("is-active").addClass("is-complete").next().removeClass("is-disabled").addClass("is-active")):(t.closest(".diagnostic-form__step").prev().addClass("is-active"),s.removeClass("is-active").addClass("is-complete").prev().removeClass("is-disabled").addClass("is-active")),$(".js-styler").trigger("refresh"),d())}),$(document).on("change",".diagnostic-form__select",function(t){var e=$(this),i=e.val(),s=e.attr("name");if(""===i)return!1;"other"===i?(e.removeClass("req"),e.closest(".diagnostic-form__item-input").append('<div class="diagnostic-form__other"><input class="diagnostic-form__input diagnostic-form__input--w320 req" type="text" name="'+s+'"/></div>')):(e.addClass("req"),e.closest(".diagnostic-form__item-input").find(".diagnostic-form__other").remove())}),$("input").keypress(function(t){13==t.which&&t.preventDefault()}),$(document).on("submit",".js-diagnostic-form",function(t){t.preventDefault();var e=$(this).serializeObject();SendAjax("DIAGNOSTIC_SUBMIT",e,function(t){location.href=t.redirect_url})})}}}();$(function(){$(".js-diagnostic-form").length&&DiagnosticForm.init()});var DiagnosticResult=function(){var t=function(){768<=window.innerWidth?($(".js-diagnostic-result-right").css({height:$(".js-diagnostic-result-left").height()+"px"}),$(".js-diagnostic-result-cons").stick_in_parent({offset_top:$(".header").height()+20})):($(".js-diagnostic-result-right").css({height:"auto"}),$(".js-diagnostic-result-cons").trigger("sticky_kit:detach"))};return{init:function(){t(),$(window).on("scroll, resize",function(){t()})}}}();$(function(){$(".js-diagnostic-result").length&&DiagnosticResult.init()});