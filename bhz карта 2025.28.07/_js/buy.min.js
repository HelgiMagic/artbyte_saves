$(function(){function o(t){this.code=t.code,this.type=t.type,this.markIcon="/_img/map/mark.png",this.markIconActive="/_img/map/mark-active.png",this.mCusterOption={gridSize:60,styles:[{url:"/_img/map/m1.png",height:57,width:38,anchor:[10,0],textColor:"#000",textSize:14,iconAnchor:[20,0]}]},this.zoom=10,this.markers={},this.infowindow={},this.init()}o.prototype={init:function(){this.render()},render:function(){this.getObjects()},initMap:function(){this.map=new google.maps.Map(document.getElementById("map"),{zoom:3,center:{lat:this.objects.center.lat,lng:this.objects.center.lng}})},getObjects:function(){var i=this;SendAjax("GET_BUY_INFO",{code:this.code,type:this.type},function(t){i.objects=t,i.initMap(),i.setMarks(),i.setInfo(),i.bindChange()})},setMarks:function(){var s=this;this.objects.addresses.forEach(function(t,i,o){s.markers[t.id]=new google.maps.Marker({position:t.coordinates,map:s.map,icon:s.markIcon,title:t.name,animation:google.maps.Animation.DROP}),s.markers[t.id].coordinates=t.coordinates}),s.MarkerClusterer=new MarkerClusterer(s.map,s.markers,s.mCusterOption)},setInfo:function(){var i=this;this.objects.addresses.forEach(function(t){i.infowindow[t.id]=new google.maps.InfoWindow({content:'<div class="contacts-balloon"><div class="contacts-balloon__title">'+t.name+'</div><table class="contacts-balloon__table"><tr><td><img src="/_img/contacts/c-mark.svg" alt=""></td><td>'+t.address+'</td></tr><tr><td><img src="/_img/contacts/c-phone.svg" alt=""></td><td><a href="tel:'+t.phone+'">'+t.phone+'</a></td></tr><tr><td><img src="/_img/contacts/c-message.svg" alt=""></td><td><a href="mailto:'+t.email+'">'+t.email+"</a></td></tr></table></div>"})})},bindChange:function(){var i=this;Object.keys(this.markers).map(function(t){i.markers[t].addListener("click",function(){i.infoChange(t)})}),$(document).on("click",".js-mark-show",function(){var t=$(this).data("id");i.infoChange(t,i.zoom)}),Object.keys(this.infowindow).map(function(t){i.infowindow[t].addListener("closeclick",function(){i.infoClose(i.markIdActive)})})},infoChange:function(t,i){t==this.markIdActive&&$(".js-mark-show[data-id="+t+"]").is(".is-active")?this.infoClose(this.markIdActive):($(".js-mark-show").is(".is-active")&&this.infoClose(this.markIdActive),this.infoOpen(t,i))},infoClose:function(t){this.markers[t].setIcon(this.markIcon),this.infowindow[this.markIdActive].close(),$(".js-mark-show[data-id="+this.markIdActive+"]").removeClass("is-active")},infoOpen:function(t,i){i&&this.map.getZoom()<=this.zoom&&(this.map.setCenter(this.markers[t].coordinates),this.map.setZoom(i)),this.markers[t].setIcon(this.markIconActive),this.infowindow[t].open(this.map,this.markers[t]),$(".js-mark-show[data-id="+t+"]").addClass("is-active"),this.markIdActive=t,this.scrollTo()},scrollTo:function(){var t=$(".buy__map").offset().top-200;$(window).scrollTop()>t&&$("html, body").animate({scrollTop:t},500)}},$(function(){if($(".js-buy").length){var t=$(".js-buy").data("code"),i=$(".js-buy").data("type");console.log(t,i),new o({code:t,type:i})}})});